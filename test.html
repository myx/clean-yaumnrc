<html>
	<head>
		<script>
			var module = { export : {} };
		</script>
		<script src="index.js"></script>
		<script>
			function test(){
				var Config = module.exports;
				var config = Config.parse({
					"locations" : {
						"h1" : {
							"name" : "h1.myx.ru",
							"wan3" : "5.9.15.205",
							"lan3" : "192.168.1.1",
							"tap3" : "10.112.11.20"
						},
						"h2" : {
							"name" : "h2.myx.ru",
							"wan3" : "5.9.100.81"
						},
						"o2" : {
							"name" : "o2.myx.ru",
							"routing" : {
								"external" : "9.9.9.9",
								"gateway" : ["10.1.1.1", "10.2.2.2", "10.3.3.3"],
								"tap" : { 
									"ip" : "10.112.21.20" 
								}
							},
						},
						"g1" : {
							"name" : "g1.myx.ru",
							"title" : "GCP (Google Cloud Platform)"
						},
						"a1" : {
							"name" : "a1.myx.ru",
							"title" : "AWS (Amazon Web S?)"
						}
					},
					"servers" : {
						"l6h1.myx.ru" : {
							"router" : "active",
							"location" : "h1",
							"wan" : {
								"ip" : "9.11.0.1"
							},
							"lan" : {
								"ip" : "10.9.0.1"
							},
							"tap" : { 
								"ip" : "10.112.11.21",
								"key" : "-----BEGIN RSA PUBLIC KEY-----\r\nMIIBCgKCAQEA1u1UJ1/rKCT2pVPgSAvLWeZ2RW2e72ObC7xG1YVBMUi1V8JCU0+S\r\ntEaEgNknTxNylJm2OiE50YWZzydDMf+GNq3AEqq/9S9UZRuZQlxSbTe4Ic1odgdi\r\nXMZHdMJu3Q4AOCxu8kEHGR4VelvpprjHyZxEteZ/doBSGm4TaomaAT3gI0k5TAol\r\nacjoctu+dgrL1YZA0MtPYAN0JX5yeLA0yZ7AKeHfGW5Ws5E5++Y1QdE3XNXxftL4\r\nX9dhOJBziW4TsPYTpair2oLLcmOYihnD6Bbsb87aoaKt6iheEtVzBgluN+qhzCP1\r\nA5ZgIlicbLrwHD61o83lpatE/dNDbhKVvQIDAQAB\r\n-----END RSA PUBLIC KEY-----"
							}
						},
						"l6o2.myx.ru" : {
							"router" : "active",
							"location" : "o2",
							"wan" : {
								"ip" : "9.10.0.1"
							},
							"lan" : {
								"ip" : "10.0.0.1"
							},
							"tap" : { 
								"ip" : "10.112.21.21",
								"key" : "-----BEGIN RSA PUBLIC KEY-----\r\nMIIBCgKCAQEA1u1UJ1/rKCT2pVPgSAvLWeX2RW2e72ObC7xG1YVBMUi1V8JCU0+S\r\ntEaEgNknTxNylJm2OiE50YWXzydDMf+GNq3AEqq/9S9UXRuXQlxSbTe4Ic1odgdi\r\nXMXHdMJu3Q4AOCxu8kEHGR4VelvpprjHyXxEteX/doBSGm4TaomaAT3gI0k5TAol\r\nacjoctu+dgrL1YXA0MtPYAN0JX5yeLA0yX7AKeHfGW5Ws5E5++Y1QdE3XNXxftL4\r\nX9dhOJBziW4TsPYTpair2oLLcmOYihnD6Bbsb87aoaKt6iheEtVzBgluN+qhzCP1\r\nA5XgIlicbLrwHD61o83lpatE/dNDbhKVvQIDAQAB\r\n-----END RSA PUBLIC KEY-----"
							}
						},
						"ae3.myx.ru" : {
							"location" : "h1"
						}
					},
					"" : {
					},
					"targets" : {
						"h1.myx.ru" : {
							"target" : "l6h1.myx.ru"
						},
						"o2.myx.ru" : {
							"target" : "l6o2.myx.ru",
							"ssl" : "strong"
						},
						"l6o2.myx.ru" : {
							"target" : "l6o2.myx.ru",
							"ssl" : "strong"
						},
						"l6.myx.ru" : {
							"target" : [ "l6h1.myx.ru", "l6o2.myx.ru" ]
						},
						"web.myx.ru" : {
							"target" : "l6.myx.ru"
						},
						"zyx.myx.ru" : {
							"target" : "zyxel.myx.ru"
						},
						"zyxel.myx.ru" : {
							"target" : [
								"http://zyxel.ru",
								"https://zyxel.ru"
							]
						}
					},
				});
				
				var output = document.getElementById('output');
				function out(t,x){
					var d = document.createElement('div');
					d.innerHTML = t + ": <pre>" + x + "</pre>";
					output.appendChild(d);
				}
				
				out('Config', config);
				out('Locations', config.locations);
				out('Servers', config.servers);
				out('Routers', config.routers);
				
				var viewL = config.makeView('h1');
				
				out('Config', viewL);
				out('Location', viewL.location);
				out('Location.Servers', viewL.location.servers);
				out('Location.Routers', viewL.location.routers);

				var viewR = config.makeView('g1');
				
				out('Config', viewR);
				out('Location', viewR.location);
				out('Location.Servers', viewR.location.servers);
				out('Location.Routers', viewR.location.routers);

				var viewS = config.makeView('l6h1.myx.ru');
				
				out('Config', viewS);
				out('Location', viewS.location);
				out('Server', viewS.server);
				out('Router', viewS.router);

				out('Location.Servers', viewS.location.servers);
				out('Location.Routers', viewS.location.routers);

				out('Location.wan3', viewS.location.wan3);
				out('Location.lan3', viewS.location.lan3);

				out('Router.wan3', viewS.router.wan3);
				out('Router.lan3', viewS.router.lan3);

				out('Router.location', viewS.router.location);
				
				
				out('Config.Source', config.toSource());
				
				
				out('Config.Servers["l6h1.myx.ru"].endpoints', config.servers.map["l6h1.myx.ru"].endpointsList);
				out('Config.Targets["l6.myx.ru"].endpoints', config.targets.map["l6.myx.ru"].endpointsList);
				out('Config.Targets["l6o2.myx.ru"].endpoints', config.targets.map["l6o2.myx.ru"].endpointsList);
				out('Config.Targets["o2.myx.ru"].endpoints', config.targets.map["o2.myx.ru"].endpointsList);
				out('Targets["web.myx.ru"].endpoints', viewS.targets.map["web.myx.ru"].endpointsList);
				out('Targets["zyx.myx.ru"].endpoints', viewS.targets.map["zyx.myx.ru"].endpointsList);

				out('Config.servers["l6h1.myx.ru"].selected', config.servers.map["l6h1.myx.ru"].selected);
				out('Server.selected', viewS.server.selected);

				out('targetListDns', viewS.targetListDns);
				out('wan3smart', viewS.wan3smart);
				out('Server.wan3smart', viewS.server.wan3smart);
				out('Targets["web.myx.ru"].wan3smart', viewS.targets.map["web.myx.ru"].wan3smart);
			}
		</script>
	</head>
	<body onload="test()">
		<div id="output">
		</div>
	</body>
</html>